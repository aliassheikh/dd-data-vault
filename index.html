<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Description - dd-data-vault</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Description";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> dd-data-vault
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Manual</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Description</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#purpose">Purpose</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#interfaces">Interfaces</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#batches-and-object-import-directories">Batches and Object Import Directories</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#processing">Processing</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#order-of-batches">Order of batches</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#parallelization-of-object-import-directory-processing">Parallelization of object import directory processing</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#automatic-layer-creation">Automatic layer creation</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="config/">Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="to-api/">API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="context/">Context</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="dev/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="test-db/">Database for testing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="test-dmftar/">Testing with dmftar</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">dd-data-vault</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Manual</li>
      <li class="breadcrumb-item active">Description</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/DANS-KNAW/dd-data-vault/edit/master/docs/index.md">Edit on DANS-KNAW/dd-data-vault</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="dd-data-vault">dd-data-vault<a class="headerlink" href="#dd-data-vault" title="Permanent link">&para;</a></h1>
<p>Manages a DANS Data Vault Storage Root</p>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h2>
<p>A DANS Data Vault Storage Root is an OCFL storage root that is used to store a collection of long term preservation objects.</p>
<h2 id="interfaces">Interfaces<a class="headerlink" href="#interfaces" title="Permanent link">&para;</a></h2>
<h3 id="batches-and-object-import-directories">Batches and Object Import Directories<a class="headerlink" href="#batches-and-object-import-directories" title="Permanent link">&para;</a></h3>
<p>Objects versions to be stored must be placed under the inbox in a batch directory. The layout of the batch directory is as follows:</p>
<pre><code class="language-plaintext">batch-dir
 ├── urn:nbn:nl:ui:13-26febff0-4fd4-4ee7-8a96-b0703b96f812
 │   ├── v1
 │   │   └── &lt;content files&gt;
 │   ├── v2
 │   │   └── &lt;content files&gt;
 │   ├── v2.json
 │   └── v3
 │       └── &lt;content files&gt;
 ├── urn:nbn:nl:ui:13-2ced2354-3a9d-44b1-a594-107b3af99789
 │   └── v3
 │       └── &lt;content files&gt;
 └── urn:nbn:nl:ui:13-b7c0742f-a9b2-4c11-bffe-615dbe24c8a0
      └── v1
          └── &lt;content files&gt; 
</code></pre>
<ul>
<li><code>batch-dir</code> - The batch directory is the directory where the batch of objects to be imported is placed.</li>
<li><code>urn:nbn:nl:ui:13-26febff0-4fd4-4ee7-8a96-b0703b96f812</code> - The directory name is the identifier of the object. The pattern that an
  identifier must match can be configured in the configuration file.</li>
<li><code>v1</code>, <code>v2</code>, <code>v3</code> - The version directories contain the content of the object version. The version directories must be named <code>v1</code>, <code>v2</code>, <code>v3</code>, etc.
  When updating an existing object, the first version directory must be named after the next version to be created in the OCFL object.</li>
<li>The service can also be configured to accept timestamps as version directories. In that case, the version directories are expected to be numbers,
  representing the timestamp of the version in milliseconds since the epoch. This timestamp is only used for ordering the versions in the OCFL object, so
  any number can be used as long as it is unique for the object. This option is mainly used for testing purposes.</li>
<li>A version directory must be accompanied by a JSON file named <code>vN.json</code>, where <code>N</code> is the version number (e.g. <code>v2.json</code> for
  version 2). This file is required for every version. It must have the following structure:</li>
</ul>
<p><code>json
  {
    "version-info": {
      "user": {
        "name": "John Doe",
        "email": "john.doe@mail.com"
      },
      "message": "Commit message"
    },
    "object-version-properties": {
      "dataset-version": "1.2",
      "packaging-format": "DANS RDA BagPack/1.0.0"
    }
  }</code></p>
<p>Requirements and notes:
  - The <code>version-info</code> object is mandatory and must include <code>user.name</code>, <code>user.email</code>, and <code>message</code>.
  - <code>version-info.user.email</code> may be specified with or without the <code>mailto:</code> prefix; the service will normalize it to <code>mailto:</code>.
  - The <code>object-version-properties</code> object is optional and may contain any custom properties to be stored for the object version. These are written to the
    Object Version Properties extension.</p>
<h2 id="processing">Processing<a class="headerlink" href="#processing" title="Permanent link">&para;</a></h2>
<h3 id="order-of-batches">Order of batches<a class="headerlink" href="#order-of-batches" title="Permanent link">&para;</a></h3>
<p>To ensure that updates for one object are processed in the correct order, the service will process all batches in the inbox in the order they were received.
Otherwise, it would be possible that a later batch would overtake an earlier batch. If these two batches contain updates for the same object, this would lead to
an error because the version directory would not coincide with the next expected version in the OCFL object.</p>
<h3 id="parallelization-of-object-import-directory-processing">Parallelization of object import directory processing<a class="headerlink" href="#parallelization-of-object-import-directory-processing" title="Permanent link">&para;</a></h3>
<p>Per batch the object import directory processing can be parallelized because there can be only one object import directory per object in a batch. The task that
processes the object import directory ensures that the version directories are processed in the correct order.</p>
<h3 id="automatic-layer-creation">Automatic layer creation<a class="headerlink" href="#automatic-layer-creation" title="Permanent link">&para;</a></h3>
<p>After processing a batch, the service will check if the maximum size of the layer has been reached. If this is the case, the service will create a new layer
and start the archiving process of the old layer. Since object import directories are processed in parallel, it is not possible to do a more fine-grained
check for the maximum size of the layer.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="installation/" class="btn btn-neutral float-right" title="Installation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/DANS-KNAW/dd-data-vault" class="fa fa-code-fork" style="color: #fcfcfc"> DANS-KNAW/dd-data-vault</a>
        </span>
    
    
    
      <span><a href="installation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
